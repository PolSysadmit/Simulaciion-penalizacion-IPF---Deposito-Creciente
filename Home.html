<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>REINTEGRO DEPOSITO CRECIENTE 18M - Penalización por días transcurridos (Tarifas coyunturales)</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <style>
    body {
      font-family: Verdana, Geneva, sans-serif;
      font-size: 12px;
    }

    input {
      width: 90px;
      text-align: right;
      font-family: Verdana, Geneva, sans-serif;
      font-size: 12px;
    }

    input[type="date"] {
      box-sizing: border-box;
      width: 98px;
    }

    td.clase-sangria {
      padding-left: 5px;
    }

    .input-EurosWrapper input,
    .input-PorcientoWrapper input {
      margin-right: 20px;
    }

    .input-EurosWrapper,
    .input-PorcientoWrapper {
      position: relative;
    }

    .input-EurosWrapper::after {
      content: "€";
      position: absolute;
      right: 10px;
      top: 45%;
      transform: translateY(-50%);
    }

    .input-PorcientoWrapper::after {
      content: "%";
      position: absolute;
      right: 5px;
      top: 48%;
      transform: translateY(-50%);
    }

    .TituloCalculadora,
    .TituloResultado {
      font-weight: bold;
      background-color: #E2EFDA;
    }

    .TituloResultado {
      text-align: center;
    }

    .ocultar {
      display: none;
    }

    .input-error {
      border-color: red;
    }

    .input-error-message {
      color: red;
      font-weight: bold;
    }

    .calculadora {
      width: auto;
    }

    table.calculadora td {
      white-space: normal;
      height: auto;
      width: auto;
    }

    td label {
      display: block;
      width: auto;
    }

    .CeldaSombreadaAmarillo {
      background-color: yellow;
    }

    .error {
      color: red;
      display: block;
      white-space: normal;
      width: auto;
      height: auto;
    }

    /* .resultados td:nth-child(2),
    .resultados td:nth-child(5),
    .resultados td:nth-child(8) {
      text-align: right;
    }

    .resultados td:nth-child(1),
    .resultados td:nth-child(3),
    .resultados td:nth-child(4),
    .resultados td:nth-child(7) {
      font-weight: bold;
      padding-right: 5px;
    } */

    .TituloSimulacion {
      border: 1px solid black;
    }

    .total-row,
    .total-row td {
      font-weight: bold;
      border: 1px solid black;
    }

    .euro-cell::after,
    .percent-cell::after {
      margin-right: 1px;
    }

    button {
      background-color: #00594F;
      border: none;
      color: white;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      transition-duration: 0.4s;
      cursor: pointer;
      height: 30px;
      width: 200px;
    }

    table {
      border-collapse: collapse;
    }

    tr.noBorder td {
      font-weight: bold;
      background-color: rgb(227, 240, 216);
      border-width: 0;
    }

    #tables-container-lx,
    #tables-container-rx {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
      /* Esto añadirá un espacio entre los grupos de tablas LX y RX */
      width: 70%;
      /* O reemplazar por el tamaño que se ajuste a tus necesidades */

    }

    .tables {
      flex: 1;
      box-sizing: border-box;
      width: 30%;
      margin-right: 15px;
      /* Agrega un margen a la derecha de cada tabla */
    }

    .tables td:nth-child(2) {
      text-align: right;
    }

    /* Necesitas quitar el margen de la última tabla de cada fila para mantener las tablas alineadas y evitar que la última tabla se desplace a la siguiente línea. */
    #TablaL3,
    #TablaR3 {
      margin-right: 0;
    }
  </style>
</head>

<body>
  <h1>REINTEGRO DEPOSITO CRECIENTE 18M - Penalización por días transcurridos (Tarifas coyunturales)</h1>
  <form id="calculadora">
    <table class="calculadora" style="border: hidden">
      <tr>
        <td>
          <label for="Importe">Importe (euros):</label>
        </td>
        <td>
          <div class="input-EurosWrapper">
            <!-- <input type="text" id="Importe" name="Importe" value="100000" class="input-field"> -->
            <input type="text" id="Importe" name="Importe" class="input-field" value="0">
          </div>
        </td>
        <td class="error-message-cell" id="ImporteError"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td>
          <label for="FechaInicio">Fecha inicio:</label>
        </td>
        <!-- <td><input type="date" id="FechaInicio" name="FechaInicio" value="2023-03-15"></td> -->
        <td><input type="date" id="FechaInicio" name="FechaInicio"></td>
        <td class="error-message-cell" id="FechaInicioError"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td>
          <label for="FechaVencimiento">Fecha vencimiento:</label>
        </td>
        <td><input type="date" id="FechaVencimiento" name="FechaVencimiento" readonly disabled></td>
        <!-- <td><input type="date" id="FechaVencimiento" name="FechaVencimiento" readonly disabled></td> -->
        <td class="error-message-cell" id="FechaVencimientoError"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="PorcentajePenalizacion"> % Penalización Reintegro:</label></td>
        <td>
          <div class="input-PorcientoWrapper">
            <input type="text" id="PorcentajePenalizacion" name="PorcentajePenalizacion" class="input-field" value="0">
            <!-- <input type="text" id="PorcentajePenalizacion" name="PorcentajePenalizacion" value="2" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="PorcentajePenalizacionError"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="PorcentajeRetencion">% Retención</label></td>
        <td>
          <div class="input-PorcientoWrapper">
            <input type="text" id="PorcentajeRetencion" name="PorcentajeRetencion" class="input-field" value="0">
            <!-- <input type="text" id="PorcentajeRetencion" name="PorcentajeRetencion" value="19" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="PorcentajeRetencionError"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>

      <tr>
        <td colspan="2" class="TituloResultado">1er SEMESTRE</td>
      </tr>
      <tr>
        <td>Fecha liquidación</td>
        <td><input type="date" id="FechaLiquidacion1" name="FechaLiquidacion1" readonly disabled></td>
        <!-- <td><input type="date" id="FechaLiquidacion1" name="FechaLiquidacion1" readonly disabled></td> -->
        <td class="error-message-cell" id="FechaLiquidacion1Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <td class="error-message-cell"></td> <!-- Columna para el mensaje de error -->
      <tr>
        <td>
          <label for="TipoInteres1">% Tipo de interés:</label>
        </td>
        <td>
          <div class="input-PorcientoWrapper">
            <input type="text" id="TipoInteres1" name="TipoInteres1" class="input-field" value="0">
            <!-- <input type="text" id="TipoInteres1" name="TipoInteres1" value="2.75" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="TipoInteres1Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr id="ImporteReintegroContainer1">
        <td><label for="ImporteReintegro1">Importe reintegro (euros):</label></td>
        <td>
          <div class="input-EurosWrapper">
            <input type="text" id="ImporteReintegro1" name="ImporteReintegro1" class="input-field" value="0">
            <!-- <input type="text" id="ImporteReintegro1" name="ImporteReintegro1" value="500" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="ImporteReintegro1Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="FechaReintegro1">Fecha reintegro:</label></td>
        <td><input type="date" id="FechaReintegro1" name="FechaReintegro1"></td>
        <!-- <td><input type="date" id="FechaReintegro1" name="FechaReintegro1" value="2023-05-15"></td> -->
        <td class="error-message-cell" id="FechaReintegro1Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td>&nbsp;</td>
        <td></td>
      </tr>

      <tr>
        <td colspan="2" class="TituloResultado">2º SEMESTRE</td>
      </tr>
      <tr>
        <td>Fecha liquidación</td>
        <td>
          <input type="date" id="FechaLiquidacion2" name="FechaLiquidacion2" readonly disabled>
        </td>
        <td class="error-message-cell" id="FechaLiquidacion2Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="TipoInteres2">% Tipo de interés:</label></td>
        <td>
          <div class="input-PorcientoWrapper">
            <input type="text" id="TipoInteres2" name="TipoInteres2" class="input-field" value="0">
          </div>
        </td>
        <td class="error-message-cell" id="TipoInteres2Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr id="ImporteReintegroContainer2">
        <td><label for="ImporteReintegro2">Importe reintegro (euros):</label></td>
        <td>
          <div class="input-EurosWrapper">
            <input type="text" id="ImporteReintegro2" name="ImporteReintegro2" class="input-field" value="0">
            <!-- <input type="text" id="ImporteReintegro2" name="ImporteReintegro2" value="700" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="ImporteReintegro2Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="FechaReintegro2">Fecha reintegro:</label></td>
        <td><input type="date" id="FechaReintegro2" name="FechaReintegro2"></td>
        <!-- <td><input type="date" id="FechaReintegro2" name="FechaReintegro2" value="2023-10-15"></td> -->
        <td class="error-message-cell" id="FechaReintegro2Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td></td>
        <td>&nbsp;</td>
      </tr>

      <tr>
        <td colspan="2" class="TituloResultado">3er SEMESTRE</td>
      </tr>

      <tr>
        <td>Fecha liquidación</td>
        <td><input type="date" id="FechaLiquidacion3" name="FechaLiquidacion3" readonly disabled></td>
        <td class="error-message-cell" id="FechaLiquidacion3Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="TipoInteres3">% Tipo de interés:</label></td>
        <td>
          <div class="input-PorcientoWrapper">
            <input type="text" id="TipoInteres3" name="TipoInteres3" class="input-field" value="0">
            <!-- <input type="text" id="TipoInteres3" name="TipoInteres3" value="3.75" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="TipoInteres3Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr id="ImporteReintegroContainer3">
        <td><label for="ImporteReintegro3">Importe reintegro (euros):</label></td>
        <td>
          <div class="input-EurosWrapper">
            <input type="text" id="ImporteReintegro3" name="ImporteReintegro3" class="input-field" value="0">
            <!-- <input type="text" id="ImporteReintegro3" name="ImporteReintegro3" value="800" class="input-field"> -->
          </div>
        </td>
        <td class="error-message-cell" id="ImporteReintegro3Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td><label for="FechaReintegro3">Fecha reintegro:</label></td>
        <td><input type="date" id="FechaReintegro3" name="FechaReintegro3"></td>
        <!-- <td><input type="date" id="FechaReintegro3" name="FechaReintegro3" value="2024-04-15"></td> -->
        <td class="error-message-cell" id="FechaReintegro3Error"></td> <!-- Columna para el mensaje de error -->
      </tr>

      <tr>
        <td></td>
        <td></td>
      </tr>

      <tr>
        <td></td>
        <td></td>
      </tr>

      <tr>
        <td>
          <br>
          <center><button type="button" onclick="calcularLiquidacion()">Calcular Liquidación</button></center>
        </td>
      </tr>
    </table>
  </form>
  <!-- <p>&nbsp;</p> -->
  <div id="resultados" style="display: none;">
    <!-- <div id="resultados"> -->
    <h2>Resultados</h2>
    <!-- <table class="resultados"> -->
    <!-- TODO DIVIDIR EN 3 tablas como abajo -->

    <div id="tables-container-lx" class="tables-container">
      <table id="TablaL1" class="tables">
        <tr>
          <td colspan="2" class="TituloResultado id=" TituloL1">LIQUIDACIÓN PRIMER SEMESTRE</td>
        </tr>
        <tr>
          <td>Importe vivo</td>
          <td class="euro-cell" id="ImporteVivoL1"></td>
        </tr>
        <tr>
          <td>Fecha liquidación</td>
          <td class="CeldaSombreadaAmarillo" id="FechaLiquidacionL1"></td>
        </tr>
        <tr>
          <td>Días transcurridos</td>
          <td id="DiasTranscurridosL1"></td>
        </tr>
        <tr>
          <td>Tipo de interés</td>
          <td class="percent-cell, CeldaSombreadaAmarillo" id="PorcentajeTipoInteresL1"></td>
        </tr>
        <tr>
          <td>Intereses Euros</td>
          <td class="euro-cell" id="InteresesEurosL1"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>% Retención </td>
          <td class="percent-cell, CeldaSombreadaAmarillo" id="PorcentajeRetencionL1"></td>
        </tr>
        <tr>
          <td>Retención Euros</td>
          <td class="euro-cell" id="RetencionEurosL1"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td class="TituloSimulacion" id="SimulacionLiquidacionL1">Simulación liquidación</td>
          <td style="border-top: 1px solid black; border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-top: 1px solid black; border-left: 1px solid black;">&nbsp;</td>
          <td style="border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;" class="clase-sangria"> +Intereses</td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasInteresesL1"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;" class="clase-sangria"> -Retención</td>
          <td style=" border-right: 1px solid black;" class="euro-cell" id="MenosRetencionL1"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;">&nbsp;</td>
          <td style="border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black; border-bottom: 1px solid black;">&nbsp;</td>
          <td class="total-row euro-cell" id="ResultadoL1"></td>
        </tr>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
      </table>

      <table id="TablaL2" class="tables">
        <tr>
          <td colspan="2" class="TituloResultado">LIQUIDACIÓN SEGUNDO SEMESTRE</td>
        </tr>
        <tr>
          <td>Importe vivo</td>
          <td class="euro-cell" id="ImporteVivoL2"></td>
        </tr>
        <tr>
          <td>Fecha liquidación</td>
          <td class="CeldaSombreadaAmarillo" id="FechaLiquidacionL2"></td>
        </tr>
        <tr>
          <td>Días transcurridos</td>
          <td id="DiasTranscurridosL2"></td>
        </tr>
        <tr>
          <td>Tipo de interés</td>
          <td class="percent-cell, CeldaSombreadaAmarillo" id="PorcentajeTipoInteresL2"></td>
        </tr>
        <tr>
          <td>Intereses Euros</td>
          <td class="euro-cell" id="InteresesEurosL2"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>% Retención </td>
          <td class="percent-cell, CeldaSombreadaAmarillo" id="PorcentajeRetencionL2"></td>
        </tr>
        <tr>
          <td>Retención Euros</td>
          <td class="euro-cell" id="RetencionEurosL2"></td>
        </tr>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td class="TituloSimulacion" id="SimulacionLiquidacionL2">Simulación liquidación</td>
          <td style="border-top: 1px solid black; border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-top: 1px solid black; border-left: 1px solid black;">&nbsp;</td>
          <td style="border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;" class="clase-sangria"> +Intereses</td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasInteresesL2"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;" class="clase-sangria"> -Retención</td>
          <td style=" border-right: 1px solid black;" class="euro-cell" id="MenosRetencionL2"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;">&nbsp;</td>
          <td style="border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black; border-bottom: 1px solid black;">&nbsp;</td>
          <td class="total-row euro-cell" id="ResultadoL2"></td>
        </tr>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
      </table>

      <table id="TablaL3" class="tables">
        <tr>
          <td colspan="2" class="TituloResultado">LIQUIDACIÓN TERCER SEMESTRE</td>
        </tr>
        <tr>
          <td>Importe vivo</td>
          <td class="euro-cell" id="ImporteVivoL3"></td>
        </tr>
        <tr>
          <td>Fecha liquidación</td>
          <td class="CeldaSombreadaAmarillo" id="FechaLiquidacionL3"></td>
        </tr>
        <tr>
          <td>Días transcurridos</td>
          <td id="DiasTranscurridosL3"></td>
        </tr>
        <tr>
          <td>Tipo de interés</td>
          <td class="percent-cell, CeldaSombreadaAmarillo" id="PorcentajeTipoInteresL3"></td>
        </tr>
        <tr>
          <td>Intereses Euros</td>
          <td class="euro-cell" id="InteresesEurosL3"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>% Retención </td>
          <td class="percent-cell, CeldaSombreadaAmarillo" id="PorcentajeRetencionL3"></td>
        </tr>
        <tr>
          <td>Retención Euros</td>
          <td class="euro-cell" id="RetencionEurosL3"></td>
        </tr>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td class="TituloSimulacion" id="SimulacionLiquidacionL3">Simulación liquidación</td>
          <td style="border-top: 1px solid black; border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-top: 1px solid black; border-left: 1px solid black;">&nbsp;</td>
          <td style="border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;" class="clase-sangria"> +Intereses</td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasInteresesL3"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;" class="clase-sangria"> -Retención</td>
          <td style=" border-right: 1px solid black;" class="euro-cell" id="MenosRetencionL3"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black;">&nbsp;</td>
          <td style="border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black; border-bottom: 1px solid black;">&nbsp;</td>
          <td class="total-row euro-cell" id="ResultadoL3"></td>
        </tr>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
      </table>
    </div>
    <div id="tables-container-rx" class="tables-container">
      <table id="TablaR1" class="tables">
        <tr>
          <td colspan="2" class="TituloResultado" id="TituloR1">REINTEGRO PRIMER SEMESTRE</td>
          <td id="CeldaVaciaR1"></td>
        </tr>
        <tr>
          <td id="DescripcionImporteReintegroR1">Importe Reintegro</td>
          <td class="euro-cell CeldaSombreadaAmarillo" id="ImporteReintegroR1"></td>
        </tr>
        <tr>
          <td id="DescripcionFechaReintegroR1">Fecha reintegro</td>
          <td class="CeldaSombreadaAmarillo" id="FechaReintegroR1"></td>
        </tr>
        <tr>
          <td id="DescripcionPorcentajePenalizacionR1">% Penalización</td>
          <td class="percent-cell CeldaSombreadaAmarillo" id="PorcentajePenalizacionR1"></td>
        </tr>
        <tr>
          <td id="DescripcionDiasTranscurridosR1">Días transcurridos desde inicio</td>
          <td id="DiasTranscurridosR1"></td>
        </tr>
        <tr>
          <td id="DescripcionDiasTranscurridosDesdeAnteriorLiquidacionR1">Días transcurridos desde anterior
            liquidación
          </td>
          <td id="DiasTranscurridosDesdeAnteriorLiquidacionR1"></td>
        </tr>
        <tr>
          <td id="DescripcionInteresesReintegroR1">Intereses reintegro</td>
          <td class="euro-cell" id="InteresesReintegroR1"></td>
        </tr>
        <tr>
          <td id="DescripcionPenalizacionEurosR1">Penalización Euros</td>
          <td class="euro-cell" id="PenalizacionEurosR1"></td>
        </tr>
        <tr>
          <td id="DescripcionMaximoInteresesBrutosR1">Máximo intereses brutos</td>
          <td class="euro-cell" id="MaximoInteresesBrutosR1"></td>
        </tr>
        <tr>
          <td id="DescripcionPenalizacionAplicarR1">Penalización a aplicar</td>
          <td class="euro-cell" id="PenalizacionAplicarR1"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td id="DescripcionPorcentajeRetencionR1">% Retención</td>
          <td class="percent-cell CeldaSombreadaAmarillo" id="PorcentajeRetencionR1"></td>
        </tr>
        <tr>
          <td id="DescripcionRetencionEurosR1">Retención Euros</td>
          <td class="euro-cell" id="RetencionEurosR1"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td id="TituloSimulacionR1" class="TituloSimulacion">Simulación reintegro</td>
          <td style="border-top: 1px solid black; border-right: 1px solid black;"></td>
          <td></td>
        </tr>
        <tr>
          <td id="MasCapitalDescripcionR1" style="border-top: 1px solid black; border-left: 1px solid black;"
            class="clase-sangria"> +Capital</td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasCapitalR1"></td>
          <td id="CeldaVaciaMasCapitalR1"></td>
        </tr>
        <tr>
          <td id="MasInteresesDescripcionR1" style="border-left: 1px solid black;" class="clase-sangria"> +Intereses
          </td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasInteresesR1"></td>
          <td id="CeldaVaciaMasInteresesR1"></td>
        </tr>
        <tr>
          <td id="MenosRetencionDescripcionR1" style="border-left: 1px solid black;" class="clase-sangria"> -Retención
          </td>
          <td style=" border-right: 1px solid black;" class="euro-cell" id="MenosRetencionR1"></td>
          <td id="CeldaVaciaMenosRetencionR1"></td>
        </tr>
        <tr>
          <td id="MenosPenalizacionDescripcionR1" style="border-left: 1px solid black;" class="clase-sangria">
            -Penalización
          </td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MenosPenalizacionR1"></td>
          <td id="CeldaVaciaMenosPenalizacionR1"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black; border-bottom: 1px solid black;" id="CeldaVaciaResultadoR1"></td>
          <td class="total-row euro-cell" id="ResultadoR1"></td>
          <td id="CeldaVaciaResultadoR1Extra"></td>
        </tr>
      </table>

      <table id="TablaR2" class="tables">
        <tr>
          <td colspan="2" class="TituloResultado" id="TituloR2">REINTEGRO SEGUNDO SEMESTRE</td>
          <td id="CeldaVaciaR2"></td>
        </tr>
        <tr>
          <td id="DescripcionImporteReintegroR2">Importe Reintegro</td>
          <td class="euro-cell CeldaSombreadaAmarillo" id="ImporteReintegroR2"></td>
        </tr>
        <tr>
          <td id="DescripcionFechaReintegroR2">Fecha reintegro</td>
          <td class="CeldaSombreadaAmarillo" id="FechaReintegroR2"></td>
        </tr>
        <tr>
          <td id="DescripcionPorcentajePenalizacionR2">% Penalización</td>
          <td class="percent-cell CeldaSombreadaAmarillo" id="PorcentajePenalizacionR2"></td>
        </tr>
        <tr>
          <td id="DescripcionDiasTranscurridosR2">Días transcurridos desde inicio</td>
          <td id="DiasTranscurridosR2"></td>
        </tr>
        <tr>
          <td id="DescripcionDiasTranscurridosDesdeAnteriorLiquidacionR2">Días transcurridos desde anterior
            liquidación
          </td>
          <td id="DiasTranscurridosDesdeAnteriorLiquidacionR2"></td>
        </tr>
        <tr>
          <td id="DescripcionInteresesReintegroR2">Intereses reintegro</td>
          <td class="euro-cell" id="InteresesReintegroR2"></td>
        </tr>
        <tr>
          <td id="DescripcionPenalizacionEurosR2">Penalización Euros</td>
          <td class="euro-cell" id="PenalizacionEurosR2"></td>
        </tr>
        <tr>
          <td id="DescripcionMaximoInteresesBrutosR2">Máximo intereses brutos</td>
          <td class="euro-cell" id="MaximoInteresesBrutosR2"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td id="DescripcionPenalizacionAplicarR2">Penalización a aplicar</td>
          <td class="euro-cell" id="PenalizacionAplicarR2"></td>
        </tr>
        <tr>
          <td id="DescripcionPorcentajeRetencionR2">% Retención</td>
          <td class="percent-cell CeldaSombreadaAmarillo" id="PorcentajeRetencionR2"></td>
        </tr>
        <tr>
          <td id="DescripcionRetencionEurosR2">Retención Euros</td>
          <td class="euro-cell" id="RetencionEurosR2"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td id="TituloSimulacionR2" style="border-top: 1px solid black; border-right: 1px solid black;"
            class="TituloSimulacion">Simulación reintegro</td>
          <td style="border-top: 1px solid black; border-right: 1px solid black;"></td>
          <td></td>
        </tr>
        <tr>
          <td id="MasCapitalDescripcionR2" style="border-top: 1px solid black; border-left: 1px solid black;"
            class="clase-sangria"> +Capital</td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasCapitalR2"></td>
          <td id="CeldaVaciaMasCapitalR2"></td>
        </tr>
        <tr>
          <td id="MasInteresesDescripcionR2" style="border-left: 1px solid black;" class="clase-sangria"> +Intereses
          </td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasInteresesR2"></td>
          <td id="CeldaVaciaMasInteresesR2"></td>
        </tr>
        <tr>
          <td id="MenosRetencionDescripcionR2" style="border-left: 1px solid black;" class="clase-sangria"> -Retención
          </td>
          <td style=" border-right: 1px solid black;" class="euro-cell" id="MenosRetencionR2"></td>
          <td id="CeldaVaciaMenosRetencionR2"></td>
        </tr>
        <tr>
          <td id="MenosPenalizacionDescripcionR2" style="border-left: 1px solid black;" class="clase-sangria">
            -Penalización
          </td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MenosPenalizacionR2"></td>
          <td id="CeldaVaciaMenosPenalizacionR2"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black; border-bottom: 1px solid black;" id="CeldaVaciaResultadoR2"></td>
          <td class="total-row euro-cell" id="ResultadoR2"></td>
          <td id="CeldaVaciaResultadoR2Extra"></td>
        </tr>

      </table>

      <table id="TablaR3" class="tables">
        <tr>
          <td colspan="2" class="TituloResultado" id="TituloR3">REINTEGRO TERCER SEMESTRE</td>
          <td id="CeldaVaciaR3"></td>
        </tr>
        <tr>
          <td id="DescripcionImporteReintegroR3">Importe Reintegro</td>
          <td class="euro-cell CeldaSombreadaAmarillo" id="ImporteReintegroR3"></td>
        </tr>
        <tr>
          <td id="DescripcionFechaReintegroR3">Fecha reintegro</td>
          <td class="CeldaSombreadaAmarillo" id="FechaReintegroR3"></td>
        </tr>
        <tr>
          <td id="DescripcionPorcentajePenalizacionR3">% Penalización</td>
          <td class="percent-cell CeldaSombreadaAmarillo" id="PorcentajePenalizacionR3"></td>
        </tr>
        <tr>
          <td id="DescripcionDiasTranscurridosR3">Días transcurridos desde inicio</td>
          <td id="DiasTranscurridosR3"></td>
        </tr>
        <tr>
          <td id="DescripcionDiasTranscurridosDesdeAnteriorLiquidacionR3">Días transcurridos desde anterior
            liquidación
          </td>
          <td id="DiasTranscurridosDesdeAnteriorLiquidacionR3"></td>
        </tr>
        <tr>
          <td id="DescripcionInteresesReintegroR3">Intereses reintegro</td>
          <td class="euro-cell" id="InteresesReintegroR3"></td>
        </tr>
        <tr>
          <td id="DescripcionPenalizacionEurosR3">Penalización Euros</td>
          <td class="euro-cell" id="PenalizacionEurosR3"></td>
        </tr>
        <tr>
          <td id="DescripcionMaximoInteresesBrutosR3">Máximo intereses brutos</td>
          <td class="euro-cell" id="MaximoInteresesBrutosR3"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td id="DescripcionPenalizacionAplicarR3">Penalización a aplicar</td>
          <td class="euro-cell" id="PenalizacionAplicarR3"></td>
        </tr>
        <tr>
          <td id="DescripcionPorcentajeRetencionR3">% Retención</td>
          <td class="percent-cell CeldaSombreadaAmarillo" id="PorcentajeRetencionR3"></td>
        </tr>
        <tr>
          <td id="DescripcionRetencionEurosR3">Retención Euros</td>
          <td class="euro-cell" id="RetencionEurosR3"></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td id="TituloSimulacionR3" style="border-top: 1px solid black; border-right: 1px solid black;"
            class="TituloSimulacion">Simulación reintegro</td>
          <td style="border-top: 1px solid black; border-right: 1px solid black;"></td>
        </tr>
        <tr>
          <td id="MasCapitalDescripcionR3" style="border-top: 1px solid black; border-left: 1px solid black;"
            class="clase-sangria"> +Capital</td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasCapitalR3"></td>
        </tr>
        <tr>
          <td id="MasInteresesDescripcionR3" style="border-left: 1px solid black;" class="clase-sangria"> +Intereses
          </td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MasInteresesR3"></td>
        </tr>
        <tr>
          <td id="MenosRetencionDescripcionR3" style="border-left: 1px solid black;" class="clase-sangria"> -Retención
          </td>
          <td style=" border-right: 1px solid black;" class="euro-cell" id="MenosRetencionR3"></td>
        </tr>
        <tr>
          <td id="MenosPenalizacionDescripcionR3" style="border-left: 1px solid black;" class="clase-sangria">
            -Penalización
          </td>
          <td style="border-right: 1px solid black;" class="euro-cell" id="MenosPenalizacionR3"></td>
        </tr>
        <tr>
          <td style="border-left: 1px solid black; border-bottom: 1px solid black;" id="CeldaVaciaResultadoR3"></td>
          <td class="total-row euro-cell" id="ResultadoR3"></td>
        </tr>
      </table>
    </div>

    <!-- </table> -->
  </div>
</body>


<script>
  // Código jQuery

  //Formatea número mientras se escribe.
  // Espera hasta que el documento HTML esté completamente cargado y listo
  $(document).ready(function () {

    // Selecciona todos los campos de entrada ('input') cuyo id contenga 'importe', 'Importe', 'INTERES', 'Interes', 'PORCENTAJE', 'Porcentaje', 'REINTEGRO', o 'Reintegro'
    // y que no comiencen con 'FechaReintegro'
    $('input[id*="importe"], input[id*="Importe"], input[id*="INTERES"], input[id*="Interes"], input[id*="PORCENTAJE"], input[id*="Porcentaje"], input[id*="REINTEGRO"], input[id*="Reintegro"]').not('input[id^="FechaReintegro"]').each(function () {

      // Obtiene el valor actual del campo de entrada
      let realValue = $(this).val();

      // Almacena el valor actual del campo en un atributo de datos personalizado llamado 'realvalue'
      $(this).data('realvalue', realValue);

      // Formatea el valor actual del campo para que se ajuste a las convenciones locales y lo almacena
      let formattedValue = formatearNumero(parseFloat(realValue));
      $(this).val(formattedValue);

      // Configura un controlador de eventos que se activará cada vez que el usuario cambie algo en el campo de entrada
      $(this).on('change', function () {

        // Obtiene el valor que el usuario acaba de introducir
        let thisVal = $(this).val();

        // Reemplaza todos los puntos por nada y todas las comas por puntos para normalizar el formato numérico
        thisVal = thisVal.replace(/\./g, '').replace(',', '.');

        // Almacena el valor normalizado en el atributo de datos 'realvalue'
        $(this).data('realvalue', thisVal);

        // Si el valor introducido es una cadena vacía (es decir, el campo está en blanco)
        if (thisVal === "") {
          // Simplemente establece el valor del campo como una cadena vacía
          $(this).val("");
        } else {
          // Si no, formatea el valor normalizado para que se ajuste a las convenciones locales y lo almacena de nuevo en el campo de entrada
          thisVal = formatearNumero(parseFloat(thisVal));
          $(this).val(thisVal);
        }
      });
    });
  });


  //Rellena las fechas según la fecha de inicio.
  // Espera hasta que el documento HTML esté completamente cargado y listo
  $(document).ready(function () {
    $('#FechaInicio').on('change', function () {
      var fechaInicio = new Date($(this).val());

      // Verifica que la fecha es válida
      if (!isNaN(fechaInicio.getTime())) {
        // Añade 18 meses a la fecha de inicio para la Fecha de Vencimiento
        var fechaVencimiento = new Date(fechaInicio);
        fechaVencimiento.setMonth(fechaVencimiento.getMonth() + 18);

        // Formatea la fecha de vencimiento como YYYY-MM-DD
        var fechaVencimientoString = fechaVencimiento.toISOString().split('T')[0];

        // Actualiza el campo "FechaVencimiento" con la nueva fecha calculada
        $('#FechaVencimiento').val(fechaVencimientoString);

        // Calcula las fechas de liquidación para cada semestre y las establece
        for (let i = 1; i <= 3; i++) {
          var fechaLiquidacion = new Date(fechaInicio);
          fechaLiquidacion.setMonth(fechaLiquidacion.getMonth() + 6 * i);

          var fechaLiquidacionString = fechaLiquidacion.toISOString().split('T')[0];

          // Actualiza el campo "FechaLiquidacion" con la nueva fecha calculada
          $('#FechaLiquidacion' + i).val(fechaLiquidacionString);
          $('#FechaLiquidacion' + i).prop('readonly', true);
        }
      }
    });
  });




  function mostrarError(inputId, message) {
    clearErrors();

    var inputElement = document.getElementById(inputId);
    inputElement.classList.add('input-error'); // Añadir la clase 'input-error' al input

    // Buscar la celda que contiene el input
    var inputCell = inputElement.closest('td');

    // Buscar la celda del mensaje de error
    var errorCell = inputCell.nextElementSibling;

    // Crear el elemento del mensaje de error
    var errorMessageElement = document.createElement('span');
    errorMessageElement.className = 'input-error-message';
    errorMessageElement.innerText = message;

    // Añadir el mensaje de error a la celda de error
    errorCell.appendChild(errorMessageElement);
  }


  function clearErrors() {
    // Buscar todos los campos de entrada y limpiar los errores
    document.querySelectorAll('input').forEach(function (inputElement) {
      // Remover la clase 'input-error' del input
      inputElement.classList.remove('input-error');

      // Limpiar el mensaje de error
      var errorCell = inputElement.closest('td').nextElementSibling;
      if (errorCell) {
        errorCell.innerHTML = '';
      }
    });
  }

  function obtenerValor(campo) {
    return campo.toLowerCase().includes("fecha") ?
      document.getElementById(campo).value.trim() :
      $("#" + campo).data('realvalue');
  }

  function validarCampoNumerico(campo, valor, nombreCampo) {
    if (valor === "" || isNaN(valor) || parseFloat(valor) < 0) {
      mostrarError(campo, `${nombreCampo} debe ser un valor numérico superior a 0.`);
      return false;
    }
    return true;
  }

  function validarCampoFecha(campo, valor) {
    const fecha = new Date(valor);
    if (valor !== "" && isNaN(fecha.getTime())) {
      mostrarError(campo, `El valor de '${campo}' no es una fecha válida.`);
      return false;
    }
    return true;
  }

  function validarCampoGrupo(campo, grupo) {
    let ImporteReintegro = document.getElementById("ImporteReintegro" + grupo).value;
    // let TipoInteres = document.getElementById("TipoInteres" + grupo).value;

    let FechaReintegro = document.getElementById("FechaReintegro" + grupo).value;
    // if (TipoInteres === "" || parseFloat(TipoInteres) === 0 || ImporteReintegro === "" || parseFloat(ImporteReintegro) === 0 || FechaReintegro === "" || isNaN(new Date(FechaReintegro).getTime())) {

    if (ImporteReintegro === "" || parseFloat(ImporteReintegro) === 0 || FechaReintegro === "" || isNaN(new Date(FechaReintegro).getTime())) {
      if ([ImporteReintegro, FechaReintegro].some(v => v !== "" && parseFloat(v) !== 0)) {
        mostrarError(campo, `Todos los campos del semestre ${grupo} deben tener valor, ya que al menos uno de ellos tiene valor.`);
        return false;
      }
    }
    return true;
  }

  // Modifica la función validarCampoFechaRequerido
  function validarCampoFechaRequerido(campo, valor, nombreCampo) {
    if (valor === "") {
      mostrarError(campo, `${nombreCampo} es obligatoria y debe ser una fecha válida.`);
      return false;
    }

    const fecha = new Date(valor);
    if (isNaN(fecha.getTime())) {
      mostrarError(campo, `El valor de '${nombreCampo}' no es una fecha válida.`);
      return false;
    }

    return true;
  }



  function validarCampoRequerido(campo, valor, nombreCampo) {
    if (valor === "" || parseFloat(valor) <= 0) {
      mostrarError(campo, `${nombreCampo} es obligatorio y debe ser un valor numérico superior a 0.`);
      return false;
    }
    return true;
  }




  // Esta función valida todos los campos de entrada especificados
  function validarCampos() {

    clearErrors();

    const campos = {
      "Importe": "El Importe",
      "FechaInicio": "La fecha de inicio",
      "FechaLiquidacion1": "La fecha de liquidación del 1er Semestre",
      "FechaLiquidacion2": "La fecha de liquidación del 2º Semestre",
      "FechaLiquidacion3": "La fecha de liquidación del 3er Semestre",
      "FechaVencimiento": "La fecha de vencimiento",
      "PorcentajeRetencion": "La retención",
      "PorcentajePenalizacion": "El porcentaje de penalización",
      "TipoInteres1": "El porcentaje de tipo de interés del 1er Semestre",
      "TipoInteres2": "El porcentaje de tipo de interés del 2º Semestre",
      "TipoInteres3": "El porcentaje de tipo de interés del 3er Semestre",
      "ImporteReintegro1": "El Importe reintegrado del 1er Semestre",
      "ImporteReintegro2": "El Importe reintegrado del 2º Semestre",
      "ImporteReintegro3": "El Importe reintegrado del 3er Semestre",
      "FechaReintegro1": "La fecha de reintegro del 1er Semestre",
      "FechaReintegro2": "La fecha de reintegro del 2º Semestre",
      "FechaReintegro3": "La fecha de reintegro del 3er Semestre"
    };

    let totalReintegro = 0;

    for (let campo in campos) {
      let valor = obtenerValor(campo);
      valor = valor ? valor.trim() : "";

      if (campo.toLowerCase().includes("importereintegro")) {
        totalReintegro += parseFloat(valor);
      }

      if (["Importe", "PorcentajePenalizacion", "PorcentajeRetencion", "TipoInteres1", "TipoInteres2", "TipoInteres3"].includes(campo)) {
        if (!validarCampoRequerido(campo, valor, campos[campo]) || !validarCampoNumerico(campo, valor)) return false;
      }

      // "FechaInicio" es un campo de fecha requerido
      if (["FechaInicio"].includes(campo)) {
        if (!validarCampoFechaRequerido(campo, valor, campos[campo])) return false;
      } else if (campo.toLowerCase().includes("fecha")) {
        if (!validarCampoFecha(campo, valor)) return false;
      } else if (valor !== "") {
        if (!validarCampoNumerico(campo, valor, campos[campo])) return false;
      }

      if (campo.toLowerCase().includes("fecha")) {
        if (!validarCampoFecha(campo, valor)) return false;
      } else if (valor !== "") {
        if (!validarCampoNumerico(campo, valor, campos[campo])) return false;
      }

      if (campo.includes("ImporteReintegro") || campo.includes("FechaReintegro")) {
        let grupo = campo.charAt(campo.length - 1);
        if (!validarCampoGrupo(campo, grupo)) return false;
      }


    }

    const importe = parseFloat(document.getElementById('Importe').value.trim());

    const FechaInicio = new Date(document.getElementById("FechaInicio").value);
    const FechaVencimiento = new Date(document.getElementById("FechaVencimiento").value);
    const FechaLiquidacion1 = new Date(document.getElementById("FechaLiquidacion1").value);
    const FechaLiquidacion2 = new Date(document.getElementById("FechaLiquidacion2").value);
    const FechaLiquidacion3 = new Date(document.getElementById("FechaLiquidacion3").value);
    const FechaReintegro1 = new Date(document.getElementById("FechaReintegro1").value);
    const FechaReintegro2 = new Date(document.getElementById("FechaReintegro2").value);
    const FechaReintegro3 = new Date(document.getElementById("FechaReintegro3").value);

    // Creamos un objeto para mapear cada fecha con la que debe ser posterior.
    // Las fechas que no tienen una fecha anterior se mapean a null.
    const fechas = {
      "FechaInicio": null,
      "FechaVencimiento": "FechaInicio",
      "FechaLiquidacion1": "FechaInicio",
      "FechaLiquidacion2": "FechaLiquidacion1",
      "FechaLiquidacion3": "FechaLiquidacion2",
      "FechaReintegro1": "FechaInicio",
      "FechaReintegro2": "FechaReintegro1",
      "FechaReintegro3": "FechaReintegro2",
    };

    // Iteramos sobre cada fecha en el objeto 'fechas'.
    for (let fecha in fechas) {

      // Obtenemos la fecha que debería ser anterior a la actual.
      const fechaAnterior = fechas[fecha];

      // Si hay una fecha anterior (es decir, si fechaAnterior no es null),
      // comparamos la fecha con su fecha anterior.
      if (fechaAnterior) {

        // Creamos objetos de Date con los valores de los campos de entrada correspondientes.
        const fechaActual = new Date(document.getElementById(fecha).value);
        const fechaAnt = new Date(document.getElementById(fechaAnterior).value);

        // Si la fecha es anterior o igual a su fecha anterior, mostramos un error.
        if (fechaActual <= fechaAnt) {
          mostrarError(fecha, `La fecha '${fechaActual.toLocaleDateString()}' debe ser posterior a la fecha anterior '${fechaAnt.toLocaleDateString()}'.`);
          // Salimos de la función, ya que hemos encontrado un error.
          return false;
        }
      }
      // Verifica si el nombre del campo contiene la palabra 'fechareintegro'
      if (fecha.toLowerCase().includes("fechareintegro")) {
        // Si es así, obtén el último carácter del nombre del campo (que debería ser el número del semestre)
        let numeroSemestre = fecha.slice(-1);

        // Obtiene la fecha de inicio del documento usando su id 'FechaInicio'
        let fechaInicio = new Date(document.getElementById('FechaInicio').value);

        // Obtiene la fecha de reintegro del documento usando su id (la variable 'fecha' en este contexto)
        let fechaReintegro = new Date(document.getElementById(fecha).value);

        // Obtiene la fecha de liquidación correspondiente al semestre del documento usando su id 
        // 'FechaLiquidacion' concatenado con el número de semestre
        let fechaLiquidacion = new Date(document.getElementById('FechaLiquidacion' + numeroSemestre).value);

        // Verifica si la fecha de reintegro es anterior a la fecha de inicio o posterior a la fecha de liquidación
        // Si es así, muestra un error y devuelve falso
        if (fechaReintegro < fechaInicio || fechaReintegro > fechaLiquidacion) {
          mostrarError(fecha, `La fecha de reintegro del ${numeroSemestre} semestre debe estar dentro del ${numeroSemestre} semestre .`);
          return false;
        }
      }

    }

    // Comprueba si la suma de los reintegros supera el importe inicial
    let importeInicial = parseFloat($("#Importe").data('realvalue'));
    if (totalReintegro > importeInicial) {
      let exceso = totalReintegro - importeInicial;
      mostrarError("Importe", `La suma de los importes reintegrados '${formatearNumero(totalReintegro)}' supera el importe inicial '${formatearNumero(importeInicial)}' por '${formatearNumero(exceso)}'.`);
      return false;
    }

    // Comprueba si la suma de los reintegros es igual al importe inicial
    // if (totalReintegro !== importeInicial) {
    //   let faltante = importeInicial - totalReintegro;
    //   mostrarError("Importe", `La suma de los importes reintegrados '${formatearNumero(totalReintegro)}' es menor que el importe inicial '${formatearNumero(importeInicial)}' por '${formatearNumero(faltante)}'.`);
    //   return false;
    // }


    return true;
  }

  function actualizarVisibilidad() {
    let valorReintegro1 = document.getElementById('ImporteReintegro1').value.trim();
    let valorReintegro2 = document.getElementById('ImporteReintegro2').value.trim();
    let valorReintegro3 = document.getElementById('ImporteReintegro3').value.trim();

    let condicionParaPrimerSemestre = valorReintegro1 === "" || valorReintegro1 === "0" || valorReintegro1 === "0,00";
    let condicionParaSegundoSemestre = valorReintegro2 === "" || valorReintegro2 === "0" || valorReintegro2 === "0,00";
    let condicionParaTercerSemestre = valorReintegro3 === "" || valorReintegro3 === "0" || valorReintegro3 === "0,00";


    // Ocultar tabla R1 si se cumple la condición para el primer semestre
    let tablaR1 = document.getElementById('TablaR1');
    tablaR1.style.visibility = condicionParaPrimerSemestre ? 'hidden' : 'visible';

    // Ocultar tabla R2 si se cumple la condición para el segundo semestre
    let tablaR2 = document.getElementById('TablaR2');
    tablaR2.style.visibility = condicionParaSegundoSemestre ? 'hidden' : 'visible';

    // Ocultar tabla R3 si se cumple la condición para el tercer semestre
    let tablaR3 = document.getElementById('TablaR3');
    tablaR3.style.visibility = condicionParaTercerSemestre ? 'hidden' : 'visible';

  }




  // Crea una función para mostrar los resultados
  function showResults() {

    const resultadosDiv = document.getElementById("resultados");

    actualizarVisibilidad();

    resultadosDiv.style.display = "block";

    window.scrollTo(0, document.body.scrollHeight);


  }

  // Función que se ejecuta cuando se presiona una tecla en el formulario
  function handleKeyDown(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); // Evita la acción predeterminada del evento (por ejemplo, enviar el formulario)
      calcularLiquidacion(); // Llama a la función para calcular la liquidación
    }
  }

  // Agrega el event listener al objeto document
  document.addEventListener("keydown", handleKeyDown);

  function hideResults() {
    const resultadosDiv = document.getElementById("resultados");
    resultadosDiv.style.display = "none";
  }

  function calcularDuracion(FechaInicio, fechaFin) {
    const MS_PER_DAY = 1000 * 60 * 60 * 24;
    const DIAS_EN_UN_MES = 30.44;
    const duracionMeses = (fechaFin - FechaInicio) / (MS_PER_DAY * DIAS_EN_UN_MES);
    const duracionDias = Math.round((fechaFin - FechaInicio) / MS_PER_DAY);

    return {
      duracionMeses,
      duracionDias
    };
  }


  function formatearNumero(numero) {
    return numero.toLocaleString("es-ES", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
      useGrouping: true,
    });
  }

  function formatearFecha(fecha) {
    return fecha.toLocaleDateString("es-ES");
  }

  function rellenarCamposAnidados(obj) {
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        var subObj = obj[key];
        for (var subKey in subObj) {
          if (subObj.hasOwnProperty(subKey)) {
            var subArray = subObj[subKey];
            for (var i = 0; i < subArray.length; i++) {
              var fullKey = subKey + key + (i + 1); // Construir el id del elemento
              var elem = document.getElementById(fullKey);
              if (elem) {
                if (subArray[i] instanceof Date) {
                  elem.innerText = formatearFecha(subArray[i]);
                } else {
                  // Verificar si la subKey contiene "dias" o "Porcentaje" antes de formatear el número
                  if (subKey.includes("Dias")) {
                    elem.innerText = subArray[i];
                  } else if (subKey.includes("Porcentaje")) {
                    elem.innerText = formatearNumero(subArray[i]) + " %";
                  } else {
                    elem.innerText = formatearNumero(subArray[i]) + " €";
                  }
                }
              }
            }
          }
        }
      }
    }
  }



  // Establecer eventos para ejecutar CalcularLiquidacion cuando se modifiquen los campos
  const campos = [
    "Importe",
    "FechaInicio",
    "FechaVencimiento",
    "PorcentajePenalizacion",
    "PorcentajeRetencion",
    "FechaLiquidacion1",
    "FechaLiquidacion2",
    "FechaLiquidacion3",
    "TipoInteres1",
    "TipoInteres2",
    "TipoInteres3",
    "ImporteReintegro1",
    "ImporteReintegro2",
    "ImporteReintegro3",
    "FechaReintegro1",
    "FechaReintegro2",
    "FechaReintegro3"
  ];



  for (let i = 0; i < campos.length; i++) {
    document.getElementById(campos[i]).addEventListener("change", hideResults);
  }



  function calcularLiquidacion() {




    // Obtén los valores de los elementos de entrada
    const Importe = parseFloat($("#Importe").data('realvalue'));
    // Similar para los demás campos
    const PorcentajePenalizacion = parseFloat($("#PorcentajePenalizacion").data('realvalue'));
    const PorcentajeRetencion = parseFloat($("#PorcentajeRetencion").data('realvalue'));

    const PorcentajeTipoInteres1 = parseFloat($("#TipoInteres1").data('realvalue'));
    const PorcentajeTipoInteres2 = parseFloat($("#TipoInteres2").data('realvalue'));
    const PorcentajeTipoInteres3 = parseFloat($("#TipoInteres3").data('realvalue'));

    let ImporteReintegro1 = $("#ImporteReintegro1").data('realvalue');
    let ImporteReintegro2 = $("#ImporteReintegro2").data('realvalue');
    let ImporteReintegro3 = $("#ImporteReintegro3").data('realvalue');

    if (ImporteReintegro1 === "") {
      ImporteReintegro1 = 0;
    }

    if (ImporteReintegro2 === "") {
      ImporteReintegro2 = 0;
    }

    if (ImporteReintegro3 === "") {
      ImporteReintegro3 = 0;
    }

    // Realiza la conversión a tipo float
    ImporteReintegro1 = parseFloat(ImporteReintegro1);
    ImporteReintegro2 = parseFloat(ImporteReintegro2);
    ImporteReintegro3 = parseFloat(ImporteReintegro3);

    const FechaInicio = new Date(document.getElementById("FechaInicio").value);
    const FechaVencimiento = new Date(document.getElementById("FechaVencimiento").value);

    const FechaLiquidacion1 = new Date(document.getElementById("FechaLiquidacion1").value);
    const FechaLiquidacion2 = new Date(document.getElementById("FechaLiquidacion2").value);
    const FechaLiquidacion3 = new Date(document.getElementById("FechaLiquidacion3").value);

    const FechaReintegro1 = new Date(document.getElementById("FechaReintegro1").value);
    const FechaReintegro2 = new Date(document.getElementById("FechaReintegro2").value);
    const FechaReintegro3 = new Date(document.getElementById("FechaReintegro3").value);


    // Validar los campos
    if (!validarCampos()) {
      return;
    }


    const FechaLiquidacionL1 = FechaLiquidacion1;
    const FechaLiquidacionL2 = FechaLiquidacion2;
    const FechaLiquidacionL3 = FechaLiquidacion3;

    const FechaReintegroR1 = FechaReintegro1;
    const FechaReintegroR2 = FechaReintegro2;
    const FechaReintegroR3 = FechaReintegro3;

    const PorcentajeTipoInteresL1 = PorcentajeTipoInteres1;
    const PorcentajeTipoInteresL2 = PorcentajeTipoInteres2;
    const PorcentajeTipoInteresL3 = PorcentajeTipoInteres3;

    const PorcentajeRetencionL1 = PorcentajeRetencion;
    const PorcentajeRetencionL2 = PorcentajeRetencion;
    const PorcentajeRetencionL3 = PorcentajeRetencion;

    const PorcentajeRetencionR1 = PorcentajeRetencion;
    const PorcentajeRetencionR2 = PorcentajeRetencion;
    const PorcentajeRetencionR3 = PorcentajeRetencion;


    const ImporteReintegroR1 = ImporteReintegro1;
    const ImporteReintegroR2 = ImporteReintegro2;
    const ImporteReintegroR3 = ImporteReintegro3;

    const PorcentajePenalizacionR1 = PorcentajePenalizacion;
    const PorcentajePenalizacionR2 = PorcentajePenalizacion;
    const PorcentajePenalizacionR3 = PorcentajePenalizacion;

    //Calcular Liquidaciones

    const ImporteVivoL1 = Importe - ImporteReintegroR1;
    const ImporteVivoL2 = ImporteVivoL1 - ImporteReintegroR2;
    const ImporteVivoL3 = ImporteVivoL2 - ImporteReintegroR3;

    const DiasTranscurridosL1 = Math.abs(calcularDuracion(FechaInicio, FechaLiquidacionL1).duracionDias);
    const DiasTranscurridosL2 = Math.abs(calcularDuracion(FechaLiquidacionL1, FechaLiquidacionL2).duracionDias);
    const DiasTranscurridosL3 = Math.abs(calcularDuracion(FechaLiquidacionL2, FechaLiquidacionL3).duracionDias);

    const InteresesEurosL1 = ImporteVivoL1 * (PorcentajeTipoInteres1 / 100) * DiasTranscurridosL1 / 365;
    const InteresesEurosL2 = ImporteVivoL2 * (PorcentajeTipoInteres2 / 100) * DiasTranscurridosL2 / 365;
    const InteresesEurosL3 = ImporteVivoL3 * (PorcentajeTipoInteres3 / 100) * DiasTranscurridosL3 / 365;

    const RetencionEurosL1 = InteresesEurosL1 * (PorcentajeRetencionL1 / 100);
    const RetencionEurosL2 = InteresesEurosL2 * (PorcentajeRetencionL2 / 100);
    const RetencionEurosL3 = InteresesEurosL3 * (PorcentajeRetencionL3 / 100);

    const MasInteresesL1 = Math.abs(InteresesEurosL1);
    const MasInteresesL2 = Math.abs(InteresesEurosL2);
    const MasInteresesL3 = Math.abs(InteresesEurosL3);

    const MenosRetencionL1 = -RetencionEurosL1;
    const MenosRetencionL2 = -RetencionEurosL2;
    const MenosRetencionL3 = -RetencionEurosL3;

    const ResultadoL1 = Math.abs(MasInteresesL1 + MenosRetencionL1);
    const ResultadoL2 = Math.abs(MasInteresesL2 + MenosRetencionL2);
    const ResultadoL3 = Math.abs(MasInteresesL3 + MenosRetencionL3);

    //Calcular Reintegros

    const DiasTranscurridosR1 = Math.abs(calcularDuracion(FechaInicio, FechaReintegroR1).duracionDias);
    const DiasTranscurridosR2 = Math.abs(calcularDuracion(FechaInicio, FechaReintegroR2).duracionDias);
    const DiasTranscurridosR3 = Math.abs(calcularDuracion(FechaInicio, FechaReintegroR3).duracionDias);

    const DiasTranscurridosDesdeAnteriorLiquidacionR1 = Math.abs(DiasTranscurridosR1);
    const DiasTranscurridosDesdeAnteriorLiquidacionR2 = Math.abs(calcularDuracion(FechaReintegroR2, FechaLiquidacionL1).duracionDias);
    const DiasTranscurridosDesdeAnteriorLiquidacionR3 = Math.abs(calcularDuracion(FechaReintegroR3, FechaLiquidacionL2).duracionDias);

    const InteresesReintegroR1 = Math.abs(ImporteReintegroR1) * (PorcentajeTipoInteres1 / 100) * DiasTranscurridosR1 / 365;
    const InteresesReintegroR2 = Math.abs(ImporteReintegroR2) * (PorcentajeTipoInteres2 / 100) * DiasTranscurridosDesdeAnteriorLiquidacionR2 / 365;
    const InteresesReintegroR3 = Math.abs(ImporteReintegroR3) * (PorcentajeTipoInteres3 / 100) * DiasTranscurridosDesdeAnteriorLiquidacionR3 / 365;

    const PenalizacionEurosR1 = Math.abs(ImporteReintegroR1) * (PorcentajePenalizacion / 100) * DiasTranscurridosR1 / 365;
    const PenalizacionEurosR2 = Math.abs(ImporteReintegroR2) * (PorcentajePenalizacion / 100) * DiasTranscurridosR2 / 365;
    const PenalizacionEurosR3 = Math.abs(ImporteReintegroR3) * (PorcentajePenalizacion / 100) * DiasTranscurridosR3 / 365;

    const RetencionEurosR1 = Math.abs(InteresesReintegroR1) * (PorcentajeRetencionR1 / 100);
    const RetencionEurosR2 = Math.abs(InteresesReintegroR2) * (PorcentajeRetencionR2 / 100);
    const RetencionEurosR3 = Math.abs(InteresesReintegroR3) * (PorcentajeRetencionR3 / 100);

    const MasCapitalR1 = Math.abs(ImporteReintegroR1);
    const MasCapitalR2 = Math.abs(ImporteReintegroR2);
    const MasCapitalR3 = Math.abs(ImporteReintegroR3);

    const MasInteresesR1 = Math.abs(InteresesReintegroR1);
    const MasInteresesR2 = Math.abs(InteresesReintegroR2);
    const MasInteresesR3 = Math.abs(InteresesReintegroR3);

    const MenosRetencionR1 = -RetencionEurosR1;
    const MenosRetencionR2 = -RetencionEurosR2;
    const MenosRetencionR3 = -RetencionEurosR3;

    const MaximoInteresesBrutosR1 = Math.abs(Importe) * (PorcentajeTipoInteres1 / 100) * DiasTranscurridosR1 / 365;
    const MaximoInteresesBrutosR2 = MasInteresesL1 + MasInteresesR1 + InteresesEurosL2 + InteresesReintegroR2;

    const MaximoInteresesBrutosR3 = MasInteresesL1 + MasInteresesR1 + InteresesEurosL2 + MasInteresesR2 + InteresesEurosL3 + InteresesReintegroR3;

    const PenalizacionAplicarR1 = (PenalizacionEurosR1 > MaximoInteresesBrutosR1) ? MaximoInteresesBrutosR1 : PenalizacionEurosR1;
    const PenalizacionAplicarR2 = (PenalizacionEurosR2 > MaximoInteresesBrutosR2) ? MaximoInteresesBrutosR2 : PenalizacionEurosR2;
    const PenalizacionAplicarR3 = (PenalizacionEurosR3 > MaximoInteresesBrutosR3) ? MaximoInteresesBrutosR3 : PenalizacionEurosR3;

    const MenosPenalizacionR1 = -PenalizacionAplicarR1;
    const MenosPenalizacionR2 = -PenalizacionAplicarR2;
    const MenosPenalizacionR3 = -PenalizacionAplicarR3;

    const ResultadoR1 = MasCapitalR1 + MasInteresesR1 + MenosRetencionR1 + MenosPenalizacionR1;
    const ResultadoR2 = MasCapitalR2 + MasInteresesR2 + MenosRetencionR2 + MenosPenalizacionR2;
    const ResultadoR3 = MasCapitalR3 + MasInteresesR3 + MenosRetencionR3 + MenosPenalizacionR3;


    var CamposAnidados = {
      L: {
        ImporteVivo: [ImporteVivoL1, ImporteVivoL2, ImporteVivoL3],
        PorcentajeTipoInteres: [PorcentajeTipoInteresL1, PorcentajeTipoInteresL2, PorcentajeTipoInteresL3],
        PorcentajeRetencion: [PorcentajeRetencionL1, PorcentajeRetencionL2, PorcentajeRetencionL3],
        DiasTranscurridos: [DiasTranscurridosL1, DiasTranscurridosL2, DiasTranscurridosL3],
        InteresesEuros: [InteresesEurosL1, InteresesEurosL2, InteresesEurosL3],
        FechaLiquidacion: [FechaLiquidacionL1, FechaLiquidacionL2, FechaLiquidacionL3],
        RetencionEuros: [RetencionEurosL1, RetencionEurosL2, RetencionEurosL3],
        MasIntereses: [MasInteresesL1, MasInteresesL2, MasInteresesL3],
        MenosRetencion: [MenosRetencionL1, MenosRetencionL2, MenosRetencionL3],
        Resultado: [ResultadoL1, ResultadoL2, ResultadoL3]
      },
      R: {
        FechaReintegro: [FechaReintegroR1, FechaReintegroR2, FechaReintegroR3],
        ImporteReintegro: [ImporteReintegroR1, ImporteReintegroR2, ImporteReintegroR3],
        PorcentajePenalizacion: [PorcentajePenalizacionR1, PorcentajePenalizacionR2, PorcentajePenalizacionR3],
        DiasTranscurridos: [DiasTranscurridosR1, DiasTranscurridosR2, DiasTranscurridosR3],
        DiasTranscurridosDesdeAnteriorLiquidacion: [DiasTranscurridosDesdeAnteriorLiquidacionR1, DiasTranscurridosDesdeAnteriorLiquidacionR2, DiasTranscurridosDesdeAnteriorLiquidacionR3],
        InteresesReintegro: [InteresesReintegroR1, InteresesReintegroR2, InteresesReintegroR3],
        PenalizacionEuros: [PenalizacionEurosR1, PenalizacionEurosR2, PenalizacionEurosR3],
        MaximoInteresesBrutos: [MaximoInteresesBrutosR1, MaximoInteresesBrutosR2, MaximoInteresesBrutosR3],
        PenalizacionAplicar: [PenalizacionAplicarR1, PenalizacionAplicarR2, PenalizacionAplicarR3],
        PorcentajeRetencion: [PorcentajeRetencionR1, PorcentajeRetencionR2, PorcentajeRetencionR3],
        RetencionEuros: [RetencionEurosR1, RetencionEurosR2, RetencionEurosR3],
        MasCapital: [MasCapitalR1, MasCapitalR2, MasCapitalR3],
        MasIntereses: [MasInteresesR1, MasInteresesR2, MasInteresesR3],
        MenosRetencion: [MenosRetencionR1, MenosRetencionR2, MenosRetencionR3],
        MenosPenalizacion: [MenosPenalizacionR1, MenosPenalizacionR2, MenosPenalizacionR3],
        Resultado: [ResultadoR1, ResultadoR2, ResultadoR3]
      }
    }


    rellenarCamposAnidados(CamposAnidados);

    // document.getElementById("PenalizacionAplicarR2").innerText = formatearNumero(PenalizacionAplicarR2);
    // document.getElementById("MaximoInteresesBrutosR2").innerText = MaximoInteresesBrutosR2;
    // document.getElementById("MaximoInteresesBrutosR3").innerText = MaximoInteresesBrutosR3;



    showResults();




    // Muestra los resultados en los elementos HTML correspondientes
    //document.getElementById("ImporteVivoL1").innerText = formatearNumero(ImporteVivoL1);
    // document.getElementById("diasTranscurridos").innerText = formatearNumero(diasTranscurridos);
    // document.getElementById("diasRemanentes").innerText = formatearNumero(diasRemanentes);
    // document.getElementById("InteresesEuros").innerText = formatearNumero(InteresesEuros) + " euros";
    // document.getElementById("InteresesEurosReintegro").innerText = formatearNumero(InteresesEurosReintegro) + " euros";
    // document.getElementById("InteresesEurosDevengados").innerText = formatearNumero(InteresesEurosDevengados) + " euros";
    // document.getElementById("retencionEuros").innerText = formatearNumero(retencionEuros) + " euros";
    // document.getElementById("PenalizacionEuros").innerText = formatearNumero(PenalizacionEuros) + " euros";
    // document.getElementById("MaximoInteresesBrutos").innerText = formatearNumero(MaximoInteresesBrutos) + " euros";
    // document.getElementById("penalizacionAplicar").innerText = formatearNumero(penalizacionAplicar) + " euros";
    // document.getElementById("capital").innerText = formatearNumero(capital) + " euros";
    // document.getElementById("intereses").innerText = formatearNumero(InteresesEuros) + " euros";
    // document.getElementById("retencion").innerText = formatearNumero(retencion) + " euros";
    // document.getElementById("penalizacion").innerText = formatearNumero(penalizacion) + " euros";
    // document.getElementById("total").innerText = formatearNumero(total) + " euros";


  }



</script>

</html>